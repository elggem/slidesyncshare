<html>
<head>
    <title>SlideSyncShare</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" href="style.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="./node_modules/js-yaml/dist/js-yaml.min.js"></script>
    <script src="./node_modules/marked/marked.min.js"></script>
    <script src='https://18.198.90.241:8443/external_api.js'></script>

</head>

<body>
<div id="navbar">
		<span id="logo">SlideSyncShare<br><span id="name">Hello, {{ lti.nickname }}!</span>
<input type="text" id="test">
        <button class="button" type="button" onclick="testmessage()">Test</button>
</span>
    <div id="buttonbar">
        <span class="button" onclick="previousSlide()">Previous Slide</span>
        <span class="button" onclick="nextSlide()">Next Slide</span>
        <span class="button" onclick="exit()">Exit</span>
    </div>
</div>

<div id="container">
    <div id="slides">
        <div id="slide">
            <!-- This gets it's content from javascript. -->
        </div>
    </div>

    <div id="videoconference">
<!--        <video autoplay="true" id="videoElement"></video>-->
    </div>
</div>


<!--<script>-->
<!--    // Initialize mock webcam view#}-->
<!--    var video = document.querySelector("#videoElement");-->

<!--    if (navigator.mediaDevices.getUserMedia) {-->
<!--        navigator.mediaDevices.getUserMedia({video: true})-->
<!--            .then(function (stream) {-->
<!--                video.srcObject = stream;-->
<!--            })-->
<!--            .catch(function (err) {-->
<!--                console.log(err.name + ": " + err.message);-->

<!--            });-->
<!--    }-->
<!--</script>-->
<script>
    const domain = 'moodle.elggem.pub:8443';

    {#const domain = 'meet.jit.si'#}
    const options = {
        roomName: "{{ title }}",
        width: "100%",
        {#height: 350,#}
        parentNode: document.querySelector('#videoconference'),
        configOverwrite: { openBridgeChannel: 'datachannel' },
        userInfo: {
            email: "{{ lti.nickname }}",
            displayName: "{{ lti.nickname }}"
        }
    };
    const api = new JitsiMeetExternalAPI(domain, options);

    api.addEventListener('endpointTextMessageReceived', event=>console.log("Msg received: ", event))

    function testmessage(){
        const input = document.getElementById('test')
        api.executeCommand('sendEndpointTextMessage', '', input.value);
    }
</script>


<script>
    var slidesFilename = "./slidedecks/presentation2.yml";
    var slidesFile = null;
    var currentSlide = 0;

    $.get(slidesFilename, function (data) {
        slidesFile = jsyaml.load(data);
        renderCurrentSlide();
    });


    function renderCurrentSlide() {
        if (slidesFile != null) {
            if (currentSlide >= slidesFile.slides.length)
                currentSlide = slidesFile.slides.length - 1;

            var s = slidesFile.slides[currentSlide];

            switch (slidesFile.slides[currentSlide].type) {
                case "markdown":
                    document.getElementById('slide').innerHTML = marked(s.content);
                    break;

                case "poll":
                    var h = marked("# " + s.title);
                    for (var i = 0; i < s.answers.length; i++) {
                        h += "<div class=\'pollanswer\'><input type=\'checkbox\'> " + s.answers[i] + "</div>";
                    }
                    h += "<div class=\'pollbutton\'' onclick=\'nextSlide()\'>Submit</div>";
                    document.getElementById('slide').innerHTML = h;
                    break;

                case "quiz":
                    var h = marked("# " + s.title);
                    for (var i = 0; i < s.questions.length; i++) {
                        h += "<div class=\'pollanswer\'>" + s.questions[i].prompt + "<input type=\'textfield\' style=\'float: right\'> </div>";
                    }

                    h += "<div class=\'pollbutton\'' onclick=\'nextSlide()\'>Submit</div>";
                    document.getElementById('slide').innerHTML = h;
                    break;

                default:
                    console.log("unknown slide type");
                    break;
            }

        }
    }

    function previousSlide() {
        currentSlide -= 1
        if (currentSlide < 0) currentSlide = 0;
        renderCurrentSlide();
    }

    function nextSlide() {
        currentSlide += 1
        renderCurrentSlide();
    }

    function exit() {
        document.location = "https://google.de";
    }
</script>

</body>
</html>
